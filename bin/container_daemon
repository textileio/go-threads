#!/bin/sh
# this file requires sh over bash:
set -e
user=textile
repo="$THREADS_REPO"

if [ $(id -u) -eq 0 ]; then
	echo "Changing user to $user"
	# ensure folder is writable
	su-exec "$user" test -w "$repo" || chown -R -- "$user" "$repo"
	# restart script with new privileges
	exec su-exec "$user" "$0" "$@"
fi

# if the first argument is daemon
if [ "$1" = "threadsd" ]; then
	shift
fi

exec threadsd "$@"
